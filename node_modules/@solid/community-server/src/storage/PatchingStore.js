"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PatchingStore = void 0;
const PassthroughStore_1 = require("./PassthroughStore");
/**
 * {@link ResourceStore} using decorator pattern for the `modifyResource` function.
 * If the original store supports the {@link Patch}, behaviour will be identical,
 * otherwise one of the {@link PatchHandler}s supporting the given Patch will be called instead.
 */
class PatchingStore extends PassthroughStore_1.PassthroughStore {
    constructor(source, patcher) {
        super(source);
        this.patcher = patcher;
    }
    async modifyResource(identifier, patch, conditions) {
        try {
            return await this.source.modifyResource(identifier, patch, conditions);
        }
        catch (error) {
            return this.patcher.handleSafe({ identifier, patch });
        }
    }
}
exports.PatchingStore = PatchingStore;
//# sourceMappingURL=PatchingStore.js.map